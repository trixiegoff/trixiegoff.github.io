<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>'GWAMS!1</title>
    <style>
    body {
        background-color: black;
        color: lime;
        margin: 0;
        }
        
    #log {
        position: fixed;
        z-index: -69;
        font-family: monospace, monospace, monospace;
        opacity: 0.3;
        display: block;
        }
        
    #atoms {
        display: flex;
        flex-flow: column wrap;
        flex-wrap: column wrap row;
        flex-direction: column;
        height: 100vh;
        width: 100vw;
        color: magenta;
        font-family: monospace, monospace, monospace;
        z-level: -1;
        }
        
    atom {
        display: inline-block;
        }
        
    cule {
        z-level: 1;
        display: inline-block;
        }
        
    input[type="text"] {
        position: sticky;
        top: 0px;
        background-color: rgba(0, 0, 0, 0.69);
        border: 0px solid lime;
        padding: 0px;
        color: lime;
        text-align: center;
        width: 100%;
        font-size: 27pt;
        display: block;
        }
        
    input:required:valid {
        }
        
    #status {
        position: fixed;
        bottom: 0px;
        right: 0px;
        padding: 5pt;
        z-level: 9999;
        }
    
    #spinner {
        font-size: 333%;
        opacity: 0.666;
        }
    
    body {
        padding: 50px; 
        }
    
    .spin {
        animation-name: spin;
        animation-duration: 5000ms;
        animation-iteration-count: infinite;
        animation-timing-function: linear;
        animation-direction: normal;
        }
    
    .spinfast {
        animation-duration: 2000ms;
        }
    
    .spinbackwards {
        animation-direction: reverse;
        }
    
    @keyframes spin {
        from {
            transform:rotate(0deg);
        } to {
            transform:rotate(360deg);
        }
    }
    </style>
</head>
<body>
    <script>
let readcule = function(cule, max_val) {
  max_val = BigInt(max_val)
  let out = []
  do {
    let atom = (cule & -cule) //get lowest set bit
    cule &= ~atom
    while(atom > (1n << max_val)) atom >> max_val //normalize
      let i = 1
    do {
      atom >>= 1n
      i++
    } while (atom > 0n)
    out.push(i)
  } while (cule > 0n)
  return out
}

        const gwams = new Worker("gwams.js")
        
        gwams.addEventListener("message", (msg) => {
            [type, data] = msg.data
            switch(type) {
                case "log":
                    document.getElementById("log")
                    .appendChild(document.createElement("div")
                    .appendChild(document.createTextNode(data)))
                    break
                case "atoms":
                    document.getElementById("atoms").innerHTML = "<atom>" + data.map((entry) => entry.map((words) => words.join(" | ")).join(" + ")).join("</atom><atom>")
                    break
                case "cule":
                    console.log("cule", data)
                    break
                case "progress":
                    console.log("progress", data)
                    break
                case "time":
                    console.log("time", data)
                    break
                default:
                    console.log(`unknown msg type: ${type}`, msg)
                    break
            }
        })
        gwams.postMessage(["init", "words"])
        
        document.getElementById("words").addEventListener("keypress", function(event) {
            if (event.key === "Enter") {
                event.preventDefault()
                gwams.postMessage(["cules", this.value])
            }
        })
    </script>
</head>
<body>
<div id="log"></div><br/>
<input type="text" id="words" placeholder="PUT WORDS IN ME ðŸ¥º" autofocus required oninput="gwams.postMessage(['atoms', this.value])"><br/>
<div id="atoms"></div>
<div id="status"><div id="spinner" class="spin">ðŸ« </div></div>
</body>
</html>
